<html>
  <head>
    <script src="bower_components/requirejs/require.js"></script>
    <script type="text/javascript">
      window.onload = function() {
        require([
          "numjs/context"
        ], function (
         Context
        ) {
          function print(x) {
            var res = document.createElement('div');
            document.body.appendChild(res);
            res.innerHTML = x;
          }

          function compare(description, glslfn, jsfn, iters) {
            var start_glsl = performance.now();
            for (var i = 0; i < iters; i++) {
              glslfn();
            }
            var end_glsl = performance.now();
            len_glsl = end_glsl - start_glsl;


            var start_js = performance.now();
            for (var i = 0; i < iters; i++) {
              jsfn();
            }
            var end_js = performance.now();
            len_js = end_js - start_js;

            print(description + " executed " + iters.toString() + " times:");
            print("  glsl: " + len_glsl.toString());
            print("  js: " + len_js.toString());
          }

          ctx = new Context();

          document.body.appendChild(ctx.canvas);
//          print("Value(Array()).toArray() = " + ctx.createValue(Float32Array.from([0, 1, 2, 3, 4])).toFloat32Array());
//          print("ID(Value(Array())).toArray() = " + ctx.texture_identity(ctx.createValue(Float32Array.from([0, 1, 2, 3, 4]))).toFloat32Array());
//          print("ID(Value(Array())).toArray() = " + ctx.texture_identity(ctx.createValue(Float32Array.from([1, 2, 3, 4, 5]))).toFloat32Array());

          var val1 = ctx.createValue(Float32Array.from([0, 1, 2, 3, 4]));
          var val2 = ctx.texture_identity(val1.reference());
          var val3 = ctx.texture_identity(val2.reference());

          print("val1 = Value(Array()) = " + val1.toFloat32Array());
          print("val2 = ID(val1) = " + val2.toFloat32Array());
          print("val3 = ID(val2) = " + val3.toFloat32Array());


//          print("ID(x).toArray() = " + ctx.texture_identity(x).toFloat32Array());

//          var val = ctx.texture_identity(ctx.createValue(Float32Array.from([0, 1, 2, 3, 4])));
//          print ("texture_identity(texture_identity([0, 1, 2, 3, 4]))) = " + ctx.texture_identity(val, false).toFloat32Array());



  //        print ("texture_identity([0, 1, 2, 3, 4])) = " + ctx.texture_identity(ctx.createValue(Float32Array.from([0, 1, 2, 3, 4])), false));

  /*

          print("range(8) = " + ctx.range(8, false));
          print("add(range(8), range(8)) = " + ctx.add(false, ctx.range(8), ctx.range(8)));

          print ("texture_identity(range(5)) = " + ctx.texture_identity(ctx.createValue(Float32Array.from([0, 1, 2, 3, 4])), false));

          print("range(8) = " + ctx.range(8));
          print("sum(range(8)) = " + ctx.sum(ctx.range(100)));
          print("range(5) = " + ctx.range(5));
          print("identity(range(5)) = " + ctx.identity(ctx.range(5)));
          print("mult(range(5), range(5)) = " + ctx.mult(ctx.range(5), ctx.range(5)));


          var items = 1000000;

          compare(
            "sum(range(" + items.toString() + "))",
            function () { ctx.sum(ctx.range(items)); },
            function () { ctx.range(items).reduce(function (a, b) { return a + b; }); },
            10);

          var items = 10000000;

          compare(
            "range(" + items.toString() + ")",
            function () { ctx.range(items); },
            function () { 
              var a = new Float32Array(items);
              for (var j = 0; j < a.length; j++) {
                a[j] = j;
              }
            },
            10);
  */
        });
      };
    </script>

    <style>
     body {
       background: green;
     }
     canvas {
       border: 2px solid red;
     }
    </style>
  </head>
  <body>
  </body>
</html>
